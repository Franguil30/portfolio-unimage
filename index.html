<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portfolio fotográfico | Unimage</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- Fuente moderna para un aspecto actual -->
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --brand:#f47d20;      /* Naranja corporativo */
      --brand-dark:#cf5e07; /* Tonalidad más oscura */
      --bg:#ffffff;         /* Fondo blanco */
      --card:#fafafa;       /* Tarjetas claras */
      --text:#0f1115;       /* Texto oscuro */
      --muted:#64748b;      /* Texto secundario */
      --stroke:rgba(2,6,23,.08); /* Borde sutil */
    }

    html, body {
      margin: 0;
      height: 100%;
      font-family: 'Plus Jakarta Sans', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color: var(--text);
      background: var(--bg);
    }

    a { color: inherit; text-decoration: none; }

    /* Cabecera */
    header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: #fff;
      border-bottom: 1px solid var(--stroke);
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px 20px;
    }
    .header-wrap {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
    }
    .logo img {
      height: 60px;
      display: block;
    }
    .title {
      flex-grow: 1;
    }
    .title b {
      font-weight: 800;
      font-size: 20px;
      display: block;
    }
    .title small {
      color: var(--muted);
      font-size: 14px;
    }
    .filters {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .filters button {
      background: #fff;
      border: 1px solid var(--stroke);
      color: var(--text);
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
      transition: background .2s, border-color .2s;
      box-shadow: 0 1px 0 rgba(2,6,23,.03);
    }
    .filters button:hover {
      border-color: rgba(2,6,23,.16);
    }
    .filters button[aria-pressed="true"] {
      background: var(--brand);
      border-color: var(--brand);
      color: #fff;
    }
    .admin-btn {
      background: #111827;
      color: #fff;
      border: 1px solid rgba(0,0,0,.1);
      padding: 6px 12px;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
    }
    .admin-btn:hover {
      filter: brightness(0.95);
    }
    .contact-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #25D366;
      color: #fff;
      padding: 8px 14px;
      border-radius: 999px;
      font-weight: 600;
      border: 1px solid rgba(0,0,0,.05);
      box-shadow: 0 2px 6px rgba(37,211,102,.35);
    }
    .contact-btn .icon {
      width: 18px;
      height: 18px;
      display: block;
    }

    /* Masonry estilo Pinterest */
    main {
      padding: 28px 20px 60px;
    }
    .masonry {
      max-width: 1200px;
      margin: 0 auto;
      column-count: 4;
      column-gap: 16px;
    }
    @media (max-width: 1100px) {
      .masonry { column-count: 3; }
    }
    @media (max-width: 820px) {
      .masonry { column-count: 2; }
    }
    @media (max-width: 560px) {
      .masonry { column-count: 1; }
    }
    .card {
      break-inside: avoid;
      margin: 0 0 16px;
      border-radius: 14px;
      overflow: hidden;
      background: var(--card);
      border: 1px solid var(--stroke);
      box-shadow: 0 2px 10px rgba(2,6,23,.04);
      display: block;
    }
    .card img {
      width: 100%;
      height: auto;
      display: block;
    }
    .card figcaption {
      padding: 10px 12px;
      color: var(--muted);
      font-size: 13px;
      border-top: 1px solid var(--stroke);
      background: #fff;
    }

    /* Lightbox */
    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(255,255,255,.95);
      display: none;
      place-items: center;
      padding: 20px;
      z-index: 9999; /* siempre arriba */
    }
    .lightbox.open { display: grid; }
    .lightbox img {
      max-width: 92vw;
      max-height: 85vh;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.1);
      background: #fff;
      padding: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,.1);
      cursor: zoom-out;
    }
    /* Estilos para el nuevo pie de foto del lightbox */
    .lightbox-caption {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #fff; /* Fondo blanco */
      color: var(--text); /* Color de texto general oscuro */
      padding: 10px 20px;
      border-radius: 8px;
      max-width: 80%;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1); /* Sombra más sutil */
      border: 1px solid var(--brand); /* Borde naranja */
    }
    .lightbox-caption h4 {
      margin: 0 0 5px;
      font-size: 18px;
      font-weight: 600;
      color: var(--brand); /* Título naranja */
    }
    .lightbox-caption p {
      margin: 0;
      font-size: 14px;
      color: var(--muted); /* Detalle en gris oscuro */
    }

    .lightbox .close,
    .lightbox .nav {
      position: absolute;
      background: #fff;
      border: 1px solid rgba(0,0,0,.2);
      color: #333;
      border-radius: 999px;
      width: 44px;
      height: 44px;
      display: grid;
      place-items: center;
      font-size: 22px;
      cursor: pointer;
    }
    .lightbox .close { top: 16px; right: 16px; font-size: 20px; }
    .lightbox .prev { left: 16px; top: 50%; transform: translateY(-50%); }
    .lightbox .next { right: 16px; top: 50%; transform: translateY(-50%); }

    /* Panel administrativo */
    .admin-panel {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.4);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }
    .admin-panel.open { display: flex; }
    .admin-card {
      background: #fff;
      color: var(--text);
      width: min(980px, 92vw);
      max-height: 88vh;
      overflow: auto;
      border-radius: 14px;
      box-shadow: 0 10px 40px rgba(0,0,0,.25);
      border: 1px solid rgba(0,0,0,.08);
    }
    .admin-card header {
      position: sticky;
      top: 0;
      background: #fff;
      border-bottom: 1px solid rgba(0,0,0,.08);
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .admin-card header h3 {
      margin: 0;
      font-size: 16px;
    }
    .admin-body {
      padding: 16px;
    }
    .row,
    .row-3 {
      display: grid;
      gap: 12px;
    }
    .row { grid-template-columns: 1fr 1fr; }
    .row-3 { grid-template-columns: 1fr 1fr 1fr; }
    label { font-size: 12px; color: var(--muted); }
    input[type="text"], select, textarea {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,.12);
      font-size: 14px;
    }
    textarea { min-height: 70px; }
    .dropzone {
      display: grid;
      place-items: center;
      border: 2px dashed rgba(0,0,0,.2);
      border-radius: 12px;
      padding: 20px;
      background: #fafafa;
      color: #6b7280;
      cursor: pointer;
    }
    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 10px 0;
    }
    .actions button {
      background: #111827;
      color: #fff;
      border: 1px solid rgba(0,0,0,.1);
      border-radius: 10px;
      padding: 10px 12px;
      cursor: pointer;
      font-size: 14px;
    }
    .actions button.secondary {
      background: #fff;
      color: #111827;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    th, td {
      border-bottom: 1px solid rgba(0,0,0,.08);
      padding: 8px;
      text-align: left;
    }
    th { color: var(--muted); font-weight: 600; }

    /* Botón administrador cerrado en mobile */
    @media (max-width: 600px) {
      .header-wrap { flex-wrap: wrap; }
      .title { width: 100%; }
      .filters { margin-top: 6px; }
      .contact-btn { margin-top: 10px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="header-wrap">
        <div class="logo" title="Unimage">
          <!-- Asegurá que el logo .png esté en la misma carpeta que este archivo -->
          <img src="Logo_UNIMAGE_separado-01.png" alt="Unimage"/>
        </div>
        <div class="title">
          <b>Portfolio fotográfico</b>
          <small>Políticas · Eventos · Productos</small>
          <div class="filters" role="tablist" aria-label="Filtrar por categoría">
            <button aria-pressed="true" data-filter="all">Todos</button>
            <button data-filter="politicas">Políticas</button>
            <button data-filter="eventos">Eventos</button>
            <button data-filter="productos">Productos</button>
            <button id="adminToggle" class="admin-btn" type="button">Administrar</button>
          </div>
        </div>
        <a class="contact-btn" href="https://wa.me/5493513117070?text=Hola%20Unimage%2C%20me%20gustar%C3%ADa%20consultar%20sobre%20producciones%20audiovisuales" target="_blank" rel="noopener" title="WhatsApp">
          <!-- ícono WhatsApp hecho con SVG para no depender de recursos externos -->
          <svg class="icon" viewBox="0 0 32 32" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M16.001,3.2c-7.067,0-12.8,5.733-12.8,12.8c0,2.533,0.733,4.8,2.133,6.667l-2.133,6.4l6.667-2.133 C11.201,27.733,13.6,28.8,16.001,28.8c7.067,0,12.8-5.733,12.8-12.8S23.068,3.2,16.001,3.2z M24.001,22.4 c-0.533,1.067-2.133,2.133-2.933,2.133c-0.8,0-1.333,1.067-8-1.333c-4-1.6-6.667-5.6-6.667-6.4c0-0.533,0.533-1.067,0.8-1.333 s1.067-0.267,1.333,0c0.4,0.533,1.333,2.133,1.467,2.267c0.133,0.133,0.133,0.267,0,0.4c-0.267,0.4-0.533,0.667-0.8,1.067 c-0.133,0.267-0.267,0.533-0.133,0.8c0.267,0.533,1.067,1.733,2.667,2.667c1.867,1.067,3.733,1.467,4.267,1.6 c0.533,0.133,1.067,0,1.333-0.267c0.267-0.267,0.667-0.933,0.8-1.2s0.267-0.267,0.533-0.4c0.267-0.133,1.067-0.533,1.333-0.8 c0.267-0.267,0.533-0.533,0.8-0.533c0.267,0,0.533,0,0.8,0.133c0.267,0.133,1.333,0.667,1.333,0.8 c0,0.133,0.267,0.267,0.267,0.533C24.268,20.267,24.534,21.333,24.001,22.4z"/></svg>
          WhatsApp
        </a>
      </div>
    </div>
  </header>
  <main>
    <!-- Galería generada desde JSON en tiempo de carga -->
    <section class="masonry" id="gallery"></section>
  </main>
  <!-- Script con JSON de imágenes autoadministrable -->
  <script type="application/json" id="gallery-data">
  {
    "items": [
      {"src": "https://picsum.photos/seed/pol1/900/600",  "categoria": "politicas", "titulo": "Cobertura de sesión",        "detalle": "Políticas · Cobertura de sesión"},
      {"src": "https://picsum.photos/seed/ev1/800/900",   "categoria": "eventos",   "titulo": "Evento institucional",     "detalle": "Eventos · Lanzamiento institucional"},
      {"src": "https://picsum.photos/seed/prod1/1000/700","categoria": "productos", "titulo": "Producto catálogo",        "detalle": "Productos · Catálogo"},
      {"src": "https://picsum.photos/seed/pol2/800/800",  "categoria": "politicas", "titulo": "Conferencia",              "detalle": "Políticas · Conferencia"},
      {"src": "https://picsum.photos/seed/ev2/1200/800",  "categoria": "eventos",   "titulo": "Backstage",               "detalle": "Eventos · Backstage"},
      {"src": "https://picsum.photos/seed/prod2/800/1000","categoria": "productos", "titulo": "Still life",              "detalle": "Productos · Still life"}
    ]
  }
  </script>
  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" aria-modal="true" role="dialog" aria-label="Vista de imagen">
    <button class="close" aria-label="Cerrar" title="Cerrar">✕</button>
    <button class="nav prev" aria-label="Anterior" title="Anterior">‹</button>
    <img src="" alt="Foto ampliada" />
    <button class="nav next" aria-label="Siguiente" title="Siguiente">›</button>
    <!-- Nuevo elemento para el título y detalle en el lightbox -->
    <div class="lightbox-caption">
      <h4 id="lbTitle"></h4>
      <p id="lbDetail"></p>
    </div>
  </div>
  <!-- Panel de administración oculto -->
  <div class="admin-panel" id="adminPanel" aria-modal="true" role="dialog">
    <div class="admin-card" role="document">
      <header>
        <h3>Administrar portfolio</h3>
        <button id="adminClose" class="admin-btn" type="button">Cerrar ✕</button>
      </header>
      <div class="admin-body">
        <div class="row-3">
          <div>
            <label>Categoría</label>
            <select id="admCat">
              <option value="politicas">Políticas</option>
              <option value="eventos">Eventos</option>
              <option value="productos">Productos</option>
            </select>
          </div>
          <div>
            <label>Título</label>
            <input type="text" id="admTitle" placeholder="Título de la foto" />
          </div>
          <div>
            <label>Detalle</label>
            <input type="text" id="admDetail" placeholder="Texto para figcaption" />
          </div>
        </div>
        <div class="dropzone" id="admDrop">Arrastrá imágenes aquí o hacé click para seleccionar</div>
        <input type="file" id="admFile" accept="image/*" multiple hidden />
        <div class="actions">
          <button id="admAdd">Agregar ítem</button>
          <button id="admExport" class="secondary">Exportar JSON</button>
          <button id="admImport" class="secondary">Importar JSON</button>
          <input type="file" id="admImportFile" accept="application/json" hidden />
          <button id="admSave" class="secondary">Guardar en página</button>
        </div>
        <div>
          <table id="admTable">
            <thead><tr><th>#</th><th>Preview</th><th>Categoría</th><th>Título</th><th>Detalle</th><th>Src</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Año dinámico en el pie (si existiera), se puede añadir posteriormente

    // Objeto de datos
    const dataEl = document.getElementById('gallery-data');
    const data = JSON.parse(dataEl.textContent);
    const gallery = document.getElementById('gallery');

    // Función que renderiza la galería en base a data.items
    function render() {
      gallery.innerHTML = data.items.map((it, i) => `
        <figure class="card" data-category="${it.categoria}" data-index="${i}">
          <img src="${it.src}" alt="${it.titulo || ''}" />
          <figcaption>${it.titulo || ''}</figcaption> <!-- Aquí se muestra solo el título -->
        </figure>
      `).join('');
      bindThumbs();
    }
    render();

    // Filtros
    const buttons = document.querySelectorAll('.filters button[data-filter]');
    function refreshImages() {
      return [...document.querySelectorAll('#gallery .card img')]
        .filter(img => img.closest('figure').style.display !== 'none');
    }
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        buttons.forEach(b => b.setAttribute('aria-pressed', 'false'));
        btn.setAttribute('aria-pressed', 'true');
        const f = btn.dataset.filter;
        document.querySelectorAll('#gallery .card').forEach(c => {
          c.style.display = (f === 'all' || c.dataset.category === f) ? '' : 'none';
        });
      });
    });

    // Lightbox + navegación + scroll lock + zoom + gestos
    const lbEl = document.getElementById('lightbox');
    const lbImg = lbEl.querySelector('img');
    const btnClose = lbEl.querySelector('.close');
    const btnPrev = lbEl.querySelector('.prev');
    const btnNext = lbEl.querySelector('.next');
    const lbTitleEl = lbEl.querySelector('#lbTitle'); // Nuevo: elemento para el título
    const lbDetailEl = lbEl.querySelector('#lbDetail'); // Nuevo: elemento para el detalle
    let images = refreshImages();
    let current = 0;
    let scale = 1, tx = 0, ty = 0;
    const minScale = 1, maxScale = 5;
    const applyTransform = () => {
      lbImg.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
      lbImg.style.cursor = scale > 1 ? 'grab' : 'zoom-out';
    };
    const resetTransform = () => { scale = 1; tx = 0; ty = 0; applyTransform(); };
    function show(index) {
      images = refreshImages();
      if (images.length === 0) return;
      current = (index + images.length) % images.length;
      lbImg.src = images[current].src;

      // Obtener el índice original del elemento de datos para el título y detalle
      const originalIndex = parseInt(images[current].closest('figure').dataset.index);
      const item = data.items[originalIndex];

      // Actualizar el título y detalle en el lightbox
      lbTitleEl.textContent = item.titulo || '';
      lbDetailEl.textContent = item.detalle || '';

      resetTransform();
    }
    function openWith(src) {
      images = refreshImages();
      const i = images.findIndex(im => im.src === src);
      show(i > -1 ? i : 0);
      lbEl.classList.add('open');
      document.documentElement.style.overflow = 'hidden';
      document.body.style.overflow = 'hidden';
      document.body.style.overscrollBehavior = 'contain';
    }
    function close() {
      lbEl.classList.remove('open');
      lbImg.src = '';
      lbTitleEl.textContent = ''; // Limpiar al cerrar
      lbDetailEl.textContent = ''; // Limpiar al cerrar
      document.documentElement.style.overflow = '';
      document.body.style.overflow = '';
      document.body.style.overscrollBehavior = '';
      resetTransform();
    }
    function bindThumbs() {
      document.querySelectorAll('#gallery .card img').forEach(img => {
        img.style.cursor = 'zoom-in';
        img.addEventListener('click', () => openWith(img.src));
      });
    }
    btnClose.addEventListener('click', e => { e.stopPropagation(); close(); });
    btnPrev.addEventListener('click', e => { e.stopPropagation(); show(current - 1); });
    btnNext.addEventListener('click', e => { e.stopPropagation(); show(current + 1); });
    lbEl.addEventListener('click', e => { if (e.target === lbEl) close(); });
    window.addEventListener('keydown', e => {
      if (!lbEl.classList.contains('open')) return;
      if (e.key === 'Escape') close();
      if (e.key === 'ArrowLeft') show(current - 1);
      if (e.key === 'ArrowRight') show(current + 1);
    });
    lbImg.addEventListener('click', () => { if (scale === 1) show(current + 1); });
    lbImg.addEventListener('wheel', e => {
      e.preventDefault();
      const rect = lbImg.getBoundingClientRect();
      const cx = e.clientX - rect.left;
      const cy = e.clientY - rect.top;
      const prevScale = scale;
      const factor = Math.exp(-e.deltaY * 0.0015);
      scale = Math.min(maxScale, Math.max(minScale, scale * factor));
      const k = scale / prevScale - 1;
      tx -= (cx - rect.width / 2) * k;
      ty -= (cy - rect.height / 2) * k;
      applyTransform();
    }, { passive: false });
    let isPanning = false, startX = 0, startY = 0;
    lbImg.addEventListener('mousedown', e => {
      if (scale <= 1) return;
      isPanning = true;
      lbImg.style.cursor = 'grabbing';
      startX = e.clientX - tx;
      startY = e.clientY - ty;
    });
    window.addEventListener('mousemove', e => {
      if (!isPanning) return;
      tx = e.clientX - startX;
      ty = e.clientY - startY;
      applyTransform();
    });
    window.addEventListener('mouseup', () => {
      isPanning = false;
      if (scale > 1) lbImg.style.cursor = 'grab';
    });
    lbImg.addEventListener('dblclick', e => {
      const rect = lbImg.getBoundingClientRect();
      const cx = e.clientX - rect.left;
      const cy = e.clientY - rect.top;
      const prevScale = scale;
      scale = (scale === 1 ? 2 : 1);
      const k = scale / prevScale - 1;
      tx -= (cx - rect.width / 2) * k;
      ty -= (cy - rect.height / 2) * k;
      applyTransform();
    });
    // Gestos táctiles
    let touchMode = false, startDist = 0, startScale = 1;
    let startTouchX = 0, startTouchY = 0;
    lbImg.addEventListener('touchstart', e => {
      if (e.touches.length === 2) {
        touchMode = true;
        startDist = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
        startScale = scale;
      } else if (e.touches.length === 1) {
        startTouchX = e.touches[0].clientX;
        startTouchY = e.touches[0].clientY;
        if (scale > 1) {
          isPanning = true;
          startX = startTouchX - tx;
          startY = startTouchY - ty;
        }
      }
    }, { passive: true });
    lbImg.addEventListener('touchmove', e => {
      if (touchMode && e.touches.length === 2) {
        e.preventDefault();
        const dist = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
        const rect = lbImg.getBoundingClientRect();
        const cx = (e.touches[0].clientX + e.touches[1].clientX) / 2 - rect.left;
        const cy = (e.touches[0].clientY + e.touches[1].clientY) / 2 - rect.top;
        const prevScale = scale;
        scale = Math.min(maxScale, Math.max(minScale, startScale * (dist / startDist)));
        const k = scale / prevScale - 1;
        tx -= (cx - rect.width / 2) * k;
        ty -= (cy - rect.height / 2) * k;
        applyTransform();
      } else if (isPanning && e.touches.length === 1) {
        e.preventDefault();
        tx = e.touches[0].clientX - startX;
        ty = e.touches[0].clientY - startY;
        applyTransform();
      }
    }, { passive: false });
    lbImg.addEventListener('touchend', e => {
      if (e.touches.length === 0) {
        touchMode = false;
        isPanning = false;
        if (scale > 1) lbImg.style.cursor = 'grab';
      }
      // Swipe si no hay zoom
      if (scale === 1 && e.changedTouches && e.changedTouches.length === 1) {
        const dx = e.changedTouches[0].clientX - startTouchX;
        const dy = e.changedTouches[0].clientY - startTouchY;
        if (Math.abs(dx) > 50 && Math.abs(dy) < 60) {
          if (dx < 0) show(current + 1); else show(current - 1);
        }
      }
    });

    // Administración
    const adminToggle = document.getElementById('adminToggle');
    const adminPanel = document.getElementById('adminPanel');
    const adminClose = document.getElementById('adminClose');
    const admCat = document.getElementById('admCat');
    const admTitle = document.getElementById('admTitle');
    const admDetail = document.getElementById('admDetail');
    const admDrop = document.getElementById('admDrop');
    const admFile = document.getElementById('admFile');
    const admAdd = document.getElementById('admAdd');
    const admExport = document.getElementById('admExport');
    const admImport = document.getElementById('admImport');
    const admImportFile = document.getElementById('admImportFile');
    const admSave = document.getElementById('admSave');
    const admTable = document.getElementById('admTable').querySelector('tbody');
    // Abrir admin con contraseña
    function openAdmin() {
      // Reemplaza '120398' con una contraseña más segura o un método de autenticación real
      const pwd = prompt('Ingrese la contraseña de administrador:', '');
      if (pwd !== '120398') {
        // En un entorno real, no usar 'alert'. Mejor un modal personalizado.
        alert('Contraseña incorrecta.');
        return;
      }
      adminPanel.classList.add('open');
      document.documentElement.style.overflow = 'hidden';
      document.body.style.overflow = 'hidden';
      buildTable();
    }
    function closeAdmin() {
      adminPanel.classList.remove('open');
      document.documentElement.style.overflow = '';
      document.body.style.overflow = '';
    }
    adminToggle.addEventListener('click', openAdmin);
    adminClose.addEventListener('click', closeAdmin);
    // Construir tabla
    function buildTable() {
      admTable.innerHTML = data.items.map((it, i) => {
        return `<tr data-i="${i}">
          <td>${i + 1}</td>
          <td><img src="${it.src}" alt="" style="width:56px;height:40px;object-fit:cover;border-radius:6px;border:1px solid rgba(0,0,0,.08)" /></td>
          <td><select class="t-cat">
              <option value="politicas" ${it.categoria === 'politicas' ? 'selected' : ''}>Políticas</option>
              <option value="eventos" ${it.categoria === 'eventos' ? 'selected' : ''}>Eventos</option>
              <option value="productos" ${it.categoria === 'productos' ? 'selected' : ''}>Productos</option>
          </select></td>
          <td><input class="t-title" type="text" value="${(it.titulo || '').replace(/"/g, '&quot;')}" /></td>
          <td><input class="t-detail" type="text" value="${(it.detalle || '').replace(/"/g, '&quot;')}" /></td>
          <td><input class="t-src" type="text" value="${(it.src || '').replace(/"/g, '&quot;')}" style="min-width:260px" /></td>
          <td><button class="row-del">Borrar</button></td>
        </tr>`;
      }).join('');
      // Bind
      admTable.querySelectorAll('tr').forEach(tr => {
        const i = +tr.dataset.i;
        tr.querySelector('.t-cat').addEventListener('change', e => { data.items[i].categoria = e.target.value; render(); });
        tr.querySelector('.t-title').addEventListener('input', e => { data.items[i].titulo = e.target.value; render(); });
        tr.querySelector('.t-detail').addEventListener('input', e => { data.items[i].detalle = e.target.value; render(); });
        tr.querySelector('.t-src').addEventListener('input', e => { data.items[i].src = e.target.value; render(); });
        tr.querySelector('.row-del').addEventListener('click', () => { data.items.splice(i, 1); buildTable(); render(); });
      });
    }
    // Dropzone
    function selectFiles() { admFile.click(); }
    admDrop.addEventListener('click', selectFiles);
    admDrop.addEventListener('dragover', e => { e.preventDefault(); admDrop.style.background = '#f1f5f9'; });
    admDrop.addEventListener('dragleave', () => { admDrop.style.background = '#fafafa'; });
    admDrop.addEventListener('drop', e => { e.preventDefault(); admDrop.style.background = '#fafafa'; handleFiles(e.dataTransfer.files); });
    admFile.addEventListener('change', e => handleFiles(e.target.files));
    function handleFiles(files) {
      [...files].forEach(f => {
        const url = URL.createObjectURL(f);
        data.items.push({ src: url, categoria: admCat.value, titulo: admTitle.value || f.name, detalle: admDetail.value || '' });
      });
      buildTable();
      render();
    }
    // Agregar ítem vacío
    admAdd.addEventListener('click', () => {
      data.items.push({ src: '', categoria: admCat.value, titulo: admTitle.value || '', detalle: admDetail.value || '' });
      buildTable();
      render();
    });
    // Exportar JSON
    admExport.addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'portfolio.json';
      a.click();
      URL.revokeObjectURL(a.href);
    });
    // Importar JSON
    admImport.addEventListener('click', () => admImportFile.click());
    admImportFile.addEventListener('change', async e => {
      const file = e.target.files[0]; if (!file) return;
      const text = await file.text();
      try {
        const imported = JSON.parse(text);
        if (Array.isArray(imported.items)) {
          data.items = imported.items;
          buildTable();
          render();
        } else {
          // En un entorno real, no usar 'alert'. Mejor un modal personalizado.
          alert('El archivo JSON no contiene un array "items".');
        }
      } catch (err) {
        // En un entorno real, no usar 'alert'. Mejor un modal personalizado.
        alert('Archivo JSON inválido');
      }
    });
    // Guardar en la página
    admSave.addEventListener('click', () => {
      dataEl.textContent = JSON.stringify(data);
      // En un entorno real, no usar 'alert'. Mejor un modal personalizado.
      alert('Guardado en la página. Recordá exportar el JSON para tener un respaldo.');
    });
  </script>
</body>
</html>
